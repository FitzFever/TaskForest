<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>TaskForest 3Dæ¨¡å‹æŸ¥çœ‹å™¨</title>
  <!-- Three.jsåº“ -->
  <script src="https://cdn.jsdelivr.net/npm/three@0.150.1/build/three.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/three@0.150.1/examples/js/controls/OrbitControls.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/three@0.150.1/examples/js/loaders/GLTFLoader.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/three@0.150.1/examples/js/loaders/DRACOLoader.js"></script>
  <style>
    :root {
      --primary-color: #52c41a;
      --secondary-color: #1890ff;
      --dark-bg: #001529;
      --light-bg: #f5f5f5;
      --border-color: #d9d9d9;
      --text-color: #333;
      --text-light: #999;
    }
    
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      font-family: "PingFang SC", "Microsoft YaHei", sans-serif;
      color: var(--text-color);
      background-color: var(--light-bg);
      overflow: hidden;
      display: flex;
      height: 100vh;
    }
    
    /* ä¾§è¾¹æ æ ·å¼ */
    .sidebar {
      width: 280px;
      background-color: var(--dark-bg);
      color: white;
      padding: 15px;
      display: flex;
      flex-direction: column;
      height: 100%;
      box-shadow: 2px 0 8px rgba(0, 0, 0, 0.1);
      z-index: 10;
      transition: all 0.3s;
    }
    
    .sidebar-header {
      display: flex;
      align-items: center;
      margin-bottom: 20px;
      padding-bottom: 15px;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    }
    
    .sidebar-header h1 {
      font-size: 18px;
      margin-left: 10px;
      font-weight: 500;
    }
    
    .sidebar-header .logo {
      width: 32px;
      height: 32px;
      object-fit: contain;
    }
    
    .search-box {
      position: relative;
      margin-bottom: 15px;
    }
    
    .search-box input {
      width: 100%;
      padding: 8px 12px;
      padding-left: 32px;
      border-radius: 4px;
      border: none;
      background-color: rgba(255, 255, 255, 0.1);
      color: white;
      font-size: 14px;
    }
    
    .search-box input::placeholder {
      color: rgba(255, 255, 255, 0.5);
    }
    
    .search-box::before {
      content: "ğŸ”";
      position: absolute;
      left: 10px;
      top: 8px;
      font-size: 14px;
      opacity: 0.7;
    }
    
    .categories {
      margin-bottom: 15px;
    }
    
    .category-title {
      font-size: 14px;
      color: rgba(255, 255, 255, 0.6);
      margin-bottom: 8px;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }
    
    .dropdown-arrow {
      cursor: pointer;
      transition: transform 0.3s;
      font-size: 12px;
    }
    
    .dropdown-arrow.open {
      transform: rotate(180deg);
    }
    
    .model-list {
      list-style: none;
      overflow-y: auto;
      flex: 1;
    }
    
    .model-item {
      padding: 10px 12px;
      margin-bottom: 4px;
      cursor: pointer;
      border-radius: 4px;
      transition: all 0.2s;
      display: flex;
      align-items: center;
    }
    
    .model-item:hover {
      background-color: rgba(255, 255, 255, 0.1);
    }
    
    .model-item.active {
      background-color: var(--primary-color);
      color: white;
    }
    
    .model-icon {
      margin-right: 10px;
      font-size: 18px;
    }
    
    .model-name {
      font-size: 14px;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    
    .category-list {
      list-style: none;
      margin-left: 10px;
      margin-bottom: 10px;
      max-height: 0;
      overflow: hidden;
      transition: max-height 0.3s;
    }
    
    .category-list.open {
      max-height: 500px;
    }
    
    .category-item {
      padding: 6px 12px;
      cursor: pointer;
      border-radius: 4px;
      transition: all 0.2s;
      font-size: 14px;
      display: flex;
      align-items: center;
    }
    
    .category-item:hover {
      background-color: rgba(255, 255, 255, 0.1);
    }
    
    .category-item.active {
      color: var(--primary-color);
    }
    
    .sidebar-footer {
      padding-top: 15px;
      border-top: 1px solid rgba(255, 255, 255, 0.1);
      font-size: 12px;
      color: rgba(255, 255, 255, 0.5);
      text-align: center;
    }
    
    /* ä¸»å†…å®¹åŒºåŸŸ */
    .content {
      flex: 1;
      display: flex;
      flex-direction: column;
      position: relative;
      overflow: hidden;
    }
    
    #canvas-container {
      flex: 1;
      position: relative;
      background-color: #f0f0f0;
      overflow: hidden;
    }
    
    #model-canvas {
      width: 100%;
      height: 100%;
      display: block;
    }
    
    /* å·¥å…·æ  */
    .toolbar {
      display: flex;
      justify-content: space-between;
      padding: 10px 15px;
      background-color: white;
      box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.05);
    }
    
    .toolbar-group {
      display: flex;
      gap: 10px;
    }
    
    .toolbar-button {
      padding: 6px 12px;
      background-color: white;
      border: 1px solid var(--border-color);
      border-radius: 4px;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 5px;
      transition: all 0.2s;
      font-size: 14px;
    }
    
    .toolbar-button:hover {
      border-color: var(--secondary-color);
      color: var(--secondary-color);
    }
    
    .toolbar-button.active {
      background-color: var(--secondary-color);
      border-color: var(--secondary-color);
      color: white;
    }
    
    /* é¢œè‰²é€‰æ‹©å™¨ */
    .color-picker {
      display: flex;
      align-items: center;
      gap: 5px;
    }
    
    .color-option {
      width: 20px;
      height: 20px;
      border-radius: 50%;
      cursor: pointer;
      border: 2px solid transparent;
    }
    
    .color-option.active {
      border-color: var(--secondary-color);
    }
    
    .color-white { background-color: #ffffff; }
    .color-light { background-color: #f0f0f0; }
    .color-dark { background-color: #333333; }
    .color-blue { background-color: #e6f7ff; }
    .color-green { background-color: #f6ffed; }
    
    /* åŠ è½½æç¤º */
    .loading-overlay {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-color: rgba(0, 0, 0, 0.3);
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      z-index: 100;
      color: white;
      font-size: 18px;
    }
    
    .spinner {
      border: 4px solid rgba(255, 255, 255, 0.3);
      border-radius: 50%;
      border-top: 4px solid white;
      width: 40px;
      height: 40px;
      animation: spin 1s linear infinite;
      margin-bottom: 15px;
    }
    
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    
    /* ä¿¡æ¯é¢æ¿ */
    .info-panel {
      position: absolute;
      bottom: 15px;
      left: 15px;
      background-color: rgba(0, 0, 0, 0.7);
      color: white;
      padding: 10px 15px;
      border-radius: 4px;
      font-size: 14px;
      pointer-events: none;
      max-width: 300px;
      transition: opacity 0.3s;
    }
    
    .info-panel h3 {
      margin-bottom: 5px;
      font-size: 16px;
      font-weight: normal;
    }
    
    .info-panel p {
      margin-bottom: 3px;
      font-size: 12px;
      opacity: 0.8;
    }
    
    /* å“åº”å¼è®¾è®¡ */
    @media (max-width: 768px) {
      body {
        flex-direction: column;
      }
      
      .sidebar {
        width: 100%;
        height: auto;
        max-height: 40%;
      }
      
      .content {
        height: 60%;
      }
    }
  </style>
</head>
<body>
  <!-- ä¾§è¾¹æ  -->
  <div class="sidebar">
    <div class="sidebar-header">
      <span style="font-size: 24px;">ğŸŒ³</span>
      <h1>TaskForest æ¨¡å‹æŸ¥çœ‹å™¨</h1>
    </div>
    
    <div class="search-box">
      <input type="text" id="search-input" placeholder="æœç´¢æ¨¡å‹...">
    </div>
    
    <div class="categories">
      <div class="category-title">
        <span>æ¨¡å‹åˆ†ç±»</span>
        <span class="dropdown-arrow open">â–¼</span>
      </div>
      <ul class="category-list open">
        <li class="category-item active" data-category="all">
          <span class="model-icon">ğŸ </span>
          <span>æ‰€æœ‰æ¨¡å‹</span>
        </li>
        <li class="category-item" data-category="trees">
          <span class="model-icon">ğŸŒ²</span>
          <span>æ ‘æœ¨</span>
        </li>
        <li class="category-item" data-category="plants">
          <span class="model-icon">ğŸŒ¿</span>
          <span>æ¤ç‰©</span>
        </li>
        <li class="category-item" data-category="animals">
          <span class="model-icon">ğŸ¦Š</span>
          <span>åŠ¨ç‰©</span>
        </li>
        <li class="category-item" data-category="objects">
          <span class="model-icon">ğŸ“¦</span>
          <span>ç‰©å“</span>
        </li>
        <li class="category-item" data-category="scenes">
          <span class="model-icon">ğŸï¸</span>
          <span>åœºæ™¯</span>
        </li>
        <li class="category-item" data-category="environment">
          <span class="model-icon">ğŸŒ</span>
          <span>ç¯å¢ƒ</span>
        </li>
      </ul>
    </div>
    
    <ul id="model-list" class="model-list">
      <!-- æ¨¡å‹åˆ—è¡¨å°†é€šè¿‡JavaScriptåŠ¨æ€å¡«å…… -->
      <li class="model-item">
        <span class="model-icon">â³</span>
        <span class="model-name">æ­£åœ¨åŠ è½½æ¨¡å‹åˆ—è¡¨...</span>
      </li>
    </ul>
    
    <div class="sidebar-footer">
      TaskForest æ¨¡å‹å·¥ä½œå®¤ &copy; 2025
    </div>
  </div>
  
  <!-- ä¸»å†…å®¹åŒºåŸŸ -->
  <div class="content">
    <div id="canvas-container">
      <canvas id="model-canvas"></canvas>
      
      <!-- ä¿¡æ¯é¢æ¿ -->
      <div id="info-panel" class="info-panel" style="opacity: 0;">
        <h3 id="model-title">æœªé€‰æ‹©æ¨¡å‹</h3>
        <p id="model-vertices">é¡¶ç‚¹æ•°ï¼š0</p>
        <p id="model-triangles">ä¸‰è§’é¢æ•°ï¼š0</p>
        <p id="model-materials">æè´¨æ•°ï¼š0</p>
        <p id="model-size">å°ºå¯¸ï¼š0 x 0 x 0</p>
      </div>
      
      <!-- åŠ è½½æç¤º -->
      <div id="loading-overlay" class="loading-overlay" style="display: none;">
        <div class="spinner"></div>
        <div id="loading-text">æ­£åœ¨åŠ è½½æ¨¡å‹...</div>
      </div>
    </div>
    
    <!-- å·¥å…·æ  -->
    <div class="toolbar">
      <div class="toolbar-group">
        <div class="color-picker">
          <span>èƒŒæ™¯ï¼š</span>
          <div class="color-option color-white active" data-color="#ffffff"></div>
          <div class="color-option color-light" data-color="#f0f0f0"></div>
          <div class="color-option color-dark" data-color="#333333"></div>
          <div class="color-option color-blue" data-color="#e6f7ff"></div>
          <div class="color-option color-green" data-color="#f6ffed"></div>
        </div>
      </div>
      
      <div class="toolbar-group">
        <button id="btn-auto-rotate" class="toolbar-button">
          <span>ğŸ”„</span> è‡ªåŠ¨æ—‹è½¬
        </button>
        <button id="btn-wireframe" class="toolbar-button">
          <span>ğŸ“</span> çº¿æ¡†æ¨¡å¼
        </button>
        <button id="btn-reset" class="toolbar-button">
          <span>ğŸ”™</span> é‡ç½®è§†è§’
        </button>
      </div>
    </div>
  </div>
  
  <script>
    // å…¨å±€å˜é‡
    let scene, camera, renderer, controls;
    let currentModel = null;
    let isWireframe = false;
    let isAutoRotate = false;
    let modelList = [];
    let filteredModels = [];
    let currentCategory = 'all';
    
    // åˆå§‹åŒ–Three.jsåœºæ™¯
    function initScene() {
      // åˆ›å»ºåœºæ™¯
      scene = new THREE.Scene();
      scene.background = new THREE.Color(0xffffff);
      
      // åˆ›å»ºç›¸æœº
      camera = new THREE.PerspectiveCamera(
        45, 
        window.innerWidth / window.innerHeight, 
        0.1, 
        1000
      );
      camera.position.set(5, 5, 5);
      
      // åˆ›å»ºæ¸²æŸ“å™¨
      const canvas = document.getElementById('model-canvas');
      renderer = new THREE.WebGLRenderer({ 
        canvas: canvas,
        antialias: true 
      });
      renderer.setSize(
        canvas.clientWidth, 
        canvas.clientHeight
      );
      renderer.setPixelRatio(window.devicePixelRatio);
      renderer.shadowMap.enabled = true;
      
      // æ·»åŠ è½¨é“æ§åˆ¶å™¨
      controls = new THREE.OrbitControls(camera, renderer.domElement);
      controls.enableDamping = true;
      controls.dampingFactor = 0.05;
      
      // æ·»åŠ ç¯å…‰
      const ambientLight = new THREE.AmbientLight(0xffffff, 0.5);
      scene.add(ambientLight);
      
      const directionalLight = new THREE.DirectionalLight(0xffffff, 0.8);
      directionalLight.position.set(5, 10, 7.5);
      directionalLight.castShadow = true;
      scene.add(directionalLight);
      
      // æ·»åŠ ç½‘æ ¼è¾…åŠ©çº¿
      const gridHelper = new THREE.GridHelper(10, 10, 0xcccccc, 0xcccccc);
      scene.add(gridHelper);
      
      // æ·»åŠ æ–¹å‘è¾…åŠ©çº¿
      const axesHelper = new THREE.AxesHelper(5);
      scene.add(axesHelper);
      
      // è®¾ç½®ç›¸æœºä½ç½®
      resetCamera();
      
      // ç›‘å¬çª—å£å¤§å°å˜åŒ–ï¼Œè°ƒæ•´æ¸²æŸ“å™¨å¤§å°
      window.addEventListener('resize', onWindowResize);
      
      // å¼€å§‹åŠ¨ç”»å¾ªç¯
      animate();
    }
    
    // åœ¨çª—å£å¤§å°å˜åŒ–æ—¶è°ƒæ•´æ¸²æŸ“å™¨å¤§å°
    function onWindowResize() {
      const container = document.getElementById('canvas-container');
      const width = container.clientWidth;
      const height = container.clientHeight;
      
      camera.aspect = width / height;
      camera.updateProjectionMatrix();
      
      renderer.setSize(width, height);
    }
    
    // åŠ¨ç”»å¾ªç¯
    function animate() {
      requestAnimationFrame(animate);
      
      // åº”ç”¨é˜»å°¼æ•ˆæœ
      controls.update();
      
      // è‡ªåŠ¨æ—‹è½¬
      if (isAutoRotate && currentModel) {
        currentModel.rotation.y += 0.005;
      }
      
      // æ¸²æŸ“åœºæ™¯
      renderer.render(scene, camera);
    }
    
    // é‡ç½®ç›¸æœºä½ç½®
    function resetCamera() {
      camera.position.set(5, 5, 5);
      camera.lookAt(0, 0, 0);
      controls.reset();
    }
    
    // åŠ è½½æ¨¡å‹
    function loadModel(modelPath) {
      // æ˜¾ç¤ºåŠ è½½ä¸­
      showLoading(true, `æ­£åœ¨åŠ è½½æ¨¡å‹: ${getModelFileName(modelPath)}`);
      
      // ç§»é™¤å½“å‰æ¨¡å‹
      if (currentModel) {
        scene.remove(currentModel);
        currentModel = null;
      }
      
      // åˆ›å»ºGLTFåŠ è½½å™¨
      const loader = new THREE.GLTFLoader();
      
      // å¯é€‰ï¼šæ·»åŠ Dracoè§£å‹ç¼©æ”¯æŒ
      const dracoLoader = new THREE.DRACOLoader();
      dracoLoader.setDecoderPath('https://cdn.jsdelivr.net/npm/three@0.150.1/examples/js/libs/draco/');
      loader.setDRACOLoader(dracoLoader);
      
      console.log("æ­£åœ¨åŠ è½½æ¨¡å‹è·¯å¾„:", modelPath); // æ·»åŠ æ—¥å¿—ä»¥è°ƒè¯•è·¯å¾„é—®é¢˜
      
      // åŠ è½½æ¨¡å‹
      loader.load(
        modelPath,
        // æˆåŠŸå›è°ƒ
        function(gltf) {
          // æ·»åŠ æ¨¡å‹åˆ°åœºæ™¯
          const model = gltf.scene;
          scene.add(model);
          currentModel = model;
          
          // æ›´æ–°æ¨¡å‹æè´¨
          updateMaterialsMode();
          
          // å±…ä¸­æ¨¡å‹
          centerModel(model);
          
          // æ›´æ–°æ¨¡å‹ä¿¡æ¯
          updateModelInfo(model, modelPath);
          
          // éšè—åŠ è½½ä¸­
          showLoading(false);
          
          console.log("æ¨¡å‹åŠ è½½æˆåŠŸ:", modelPath); // åŠ è½½æˆåŠŸæ—¥å¿—
        },
        // åŠ è½½è¿›åº¦å›è°ƒ
        function(xhr) {
          const percent = Math.floor((xhr.loaded / xhr.total) * 100);
          showLoading(true, `åŠ è½½è¿›åº¦: ${percent}%`);
        },
        // é”™è¯¯å›è°ƒ
        function(error) {
          console.error('æ¨¡å‹åŠ è½½å¤±è´¥:', error);
          showLoading(false);
          alert(`æ¨¡å‹åŠ è½½å¤±è´¥: ${error.message}`);
        }
      );
    }
    
    // æ˜¾ç¤ºæˆ–éšè—åŠ è½½æç¤º
    function showLoading(show, text) {
      const overlay = document.getElementById('loading-overlay');
      const loadingText = document.getElementById('loading-text');
      
      if (show) {
        overlay.style.display = 'flex';
        if (text) loadingText.textContent = text;
      } else {
        overlay.style.display = 'none';
      }
    }
    
    // å±…ä¸­æ¨¡å‹
    function centerModel(model) {
      // è®¡ç®—åŒ…å›´ç›’
      const box = new THREE.Box3().setFromObject(model);
      const center = box.getCenter(new THREE.Vector3());
      const size = box.getSize(new THREE.Vector3());
      
      // å°†æ¨¡å‹ç§»åŠ¨åˆ°åœºæ™¯ä¸­å¿ƒ
      model.position.x = -center.x;
      model.position.y = -center.y;
      model.position.z = -center.z;
      
      // è°ƒæ•´ç›¸æœºä½ç½®ä»¥é€‚åº”æ¨¡å‹å¤§å°
      const maxDim = Math.max(size.x, size.y, size.z);
      const fov = camera.fov * (Math.PI / 180);
      let cameraZ = Math.abs(maxDim / Math.sin(fov / 2));
      
      // è®¾ç½®ç›¸æœºä½ç½®
      const direction = new THREE.Vector3(1, 0.5, 1);
      direction.normalize();
      camera.position.copy(direction.multiplyScalar(cameraZ * 0.5));
      camera.lookAt(0, 0, 0);
      
      // æ›´æ–°æ§åˆ¶å™¨
      controls.update();
    }
    
    // æ›´æ–°æ¨¡å‹ä¿¡æ¯
    function updateModelInfo(model, modelPath) {
      const infoPanel = document.getElementById('info-panel');
      const modelTitle = document.getElementById('model-title');
      const modelVertices = document.getElementById('model-vertices');
      const modelTriangles = document.getElementById('model-triangles');
      const modelMaterials = document.getElementById('model-materials');
      const modelSize = document.getElementById('model-size');
      
      // è®¡ç®—æ¨¡å‹çš„åŸºæœ¬ä¿¡æ¯
      let vertexCount = 0;
      let triangleCount = 0;
      let materialCount = 0;
      
      model.traverse(function(child) {
        if (child.isMesh) {
          if (child.geometry) {
            if (child.geometry.attributes.position) {
              vertexCount += child.geometry.attributes.position.count;
            }
            if (child.geometry.index) {
              triangleCount += child.geometry.index.count / 3;
            } else if (child.geometry.attributes.position) {
              triangleCount += child.geometry.attributes.position.count / 3;
            }
          }
          if (child.material) {
            if (Array.isArray(child.material)) {
              materialCount += child.material.length;
            } else {
              materialCount++;
            }
          }
        }
      });
      
      // è®¡ç®—åŒ…å›´ç›’å¤§å°
      const box = new THREE.Box3().setFromObject(model);
      const size = box.getSize(new THREE.Vector3());
      
      // æ›´æ–°ä¿¡æ¯é¢æ¿
      modelTitle.textContent = getModelFileName(modelPath);
      modelVertices.textContent = `é¡¶ç‚¹æ•°ï¼š${vertexCount.toLocaleString()}`;
      modelTriangles.textContent = `ä¸‰è§’é¢æ•°ï¼š${Math.round(triangleCount).toLocaleString()}`;
      modelMaterials.textContent = `æè´¨æ•°ï¼š${materialCount}`;
      modelSize.textContent = `å°ºå¯¸ï¼š${size.x.toFixed(2)} Ã— ${size.y.toFixed(2)} Ã— ${size.z.toFixed(2)}`;
      
      // æ˜¾ç¤ºä¿¡æ¯é¢æ¿
      infoPanel.style.opacity = 1;
    }
    
    // è·å–æ¨¡å‹æ–‡ä»¶å
    function getModelFileName(path) {
      const parts = path.split('/');
      return parts[parts.length - 1].replace('.glb', '').replace('.gltf', '');
    }
    
    // æ›´æ–°æè´¨æ¨¡å¼ï¼ˆæ™®é€šæˆ–çº¿æ¡†ï¼‰
    function updateMaterialsMode() {
      if (!currentModel) return;
      
      currentModel.traverse((child) => {
        if (child.isMesh) {
          if (Array.isArray(child.material)) {
            child.material.forEach(mat => {
              mat.wireframe = isWireframe;
            });
          } else {
            child.material.wireframe = isWireframe;
          }
        }
      });
    }
    
    // åˆ‡æ¢çº¿æ¡†æ¨¡å¼
    function toggleWireframe() {
      isWireframe = !isWireframe;
      updateMaterialsMode();
      
      // æ›´æ–°æŒ‰é’®çŠ¶æ€
      const btnWireframe = document.getElementById('btn-wireframe');
      if (isWireframe) {
        btnWireframe.classList.add('active');
      } else {
        btnWireframe.classList.remove('active');
      }
    }
    
    // åˆ‡æ¢è‡ªåŠ¨æ—‹è½¬
    function toggleAutoRotate() {
      isAutoRotate = !isAutoRotate;
      
      // æ›´æ–°æŒ‰é’®çŠ¶æ€
      const btnAutoRotate = document.getElementById('btn-auto-rotate');
      if (isAutoRotate) {
        btnAutoRotate.classList.add('active');
      } else {
        btnAutoRotate.classList.remove('active');
      }
    }
    
    // æ”¹å˜èƒŒæ™¯é¢œè‰²
    function changeBackgroundColor(color) {
      scene.background = new THREE.Color(color);
      
      // æ›´æ–°é¢œè‰²é€‰æ‹©å™¨çŠ¶æ€
      const colorOptions = document.querySelectorAll('.color-option');
      colorOptions.forEach(option => {
        if (option.getAttribute('data-color') === color) {
          option.classList.add('active');
        } else {
          option.classList.remove('active');
        }
      });
    }
    
    // åŠ è½½æ¨¡å‹åˆ—è¡¨
    function loadModelList() {
      // æ˜¾ç¤ºåŠ è½½ä¸­
      const modelListEl = document.getElementById('model-list');
      modelListEl.innerHTML = `
        <li class="model-item">
          <span class="model-icon">â³</span>
          <span class="model-name">æ­£åœ¨åŠ è½½æ¨¡å‹åˆ—è¡¨...</span>
        </li>
      `;
      
      // å‘é€è¯·æ±‚è·å–æ¨¡å‹åˆ—è¡¨
      fetch('/list')
        .then(response => response.json())
        .then(data => {
          if (data.success) {
            modelList = data.files.map(file => {
              // æå–åˆ†ç±»ï¼ˆæ ¹æ®æ–‡ä»¶è·¯å¾„ï¼‰
              let category = 'other';
              if (file.includes('/trees/')) category = 'trees';
              else if (file.includes('/plants/')) category = 'plants';
              else if (file.includes('/animals/')) category = 'animals';
              else if (file.includes('/objects/')) category = 'objects';
              else if (file.includes('/scenes/')) category = 'scenes';
              else if (file.includes('/environment/')) category = 'environment';
              
              return {
                path: file,
                name: getModelFileName(file),
                category: category
              };
            });
            
            // é»˜è®¤æ˜¾ç¤ºæ‰€æœ‰æ¨¡å‹
            filteredModels = [...modelList];
            updateModelListUI();
          } else {
            modelListEl.innerHTML = `
              <li class="model-item">
                <span class="model-icon">âŒ</span>
                <span class="model-name">åŠ è½½æ¨¡å‹åˆ—è¡¨å¤±è´¥</span>
              </li>
            `;
            console.error('åŠ è½½æ¨¡å‹åˆ—è¡¨å¤±è´¥:', data.error);
          }
        })
        .catch(error => {
          modelListEl.innerHTML = `
            <li class="model-item">
              <span class="model-icon">âŒ</span>
              <span class="model-name">åŠ è½½æ¨¡å‹åˆ—è¡¨å¤±è´¥: ${error.message}</span>
            </li>
          `;
          console.error('åŠ è½½æ¨¡å‹åˆ—è¡¨é”™è¯¯:', error);
        });
    }
    
    // æ ¹æ®æœç´¢å’Œåˆ†ç±»è¿‡æ»¤æ¨¡å‹
    function filterModels(searchText, category) {
      if (category === 'all') {
        filteredModels = modelList.filter(model => 
          model.name.toLowerCase().includes(searchText.toLowerCase())
        );
      } else {
        filteredModels = modelList.filter(model => 
          model.name.toLowerCase().includes(searchText.toLowerCase()) && 
          model.category === category
        );
      }
      
      updateModelListUI();
    }
    
    // æ›´æ–°æ¨¡å‹åˆ—è¡¨UI
    function updateModelListUI() {
      const modelListEl = document.getElementById('model-list');
      
      if (filteredModels.length === 0) {
        modelListEl.innerHTML = `
          <li class="model-item">
            <span class="model-icon">ğŸ”</span>
            <span class="model-name">æ²¡æœ‰æ‰¾åˆ°åŒ¹é…çš„æ¨¡å‹</span>
          </li>
        `;
        return;
      }
      
      // æ·»åŠ è°ƒè¯•ä¿¡æ¯
      console.log("æ¨¡å‹åˆ—è¡¨æ€»æ•°:", filteredModels.length);
      filteredModels.forEach(model => {
        console.log("æ¨¡å‹è·¯å¾„:", model.path);
      });
      
      modelListEl.innerHTML = filteredModels.map(model => {
        // é€‰æ‹©åˆé€‚çš„å›¾æ ‡
        let icon = 'ğŸ“„';
        if (model.category === 'trees') icon = 'ğŸŒ²';
        else if (model.category === 'plants') icon = 'ğŸŒ¿';
        else if (model.category === 'animals') icon = 'ğŸ¦Š';
        else if (model.category === 'objects') icon = 'ğŸ“¦';
        else if (model.category === 'scenes') icon = 'ğŸï¸';
        else if (model.category === 'environment') icon = 'ğŸŒ';
        
        return `
          <li class="model-item" data-path="${model.path}">
            <span class="model-icon">${icon}</span>
            <span class="model-name">${model.name}</span>
          </li>
        `;
      }).join('');
      
      // æ·»åŠ ç‚¹å‡»äº‹ä»¶
      const modelItems = modelListEl.querySelectorAll('.model-item');
      modelItems.forEach(item => {
        item.addEventListener('click', function() {
          const path = this.getAttribute('data-path');
          if (path) {
            // æ›´æ–°é€‰ä¸­çŠ¶æ€
            modelItems.forEach(i => i.classList.remove('active'));
            this.classList.add('active');
            
            // åŠ è½½æ¨¡å‹
            loadModel(path);
          }
        });
      });
    }
    
    // åˆå§‹åŒ–äº‹ä»¶ç›‘å¬å™¨
    function initEventListeners() {
      // æœç´¢è¾“å…¥
      const searchInput = document.getElementById('search-input');
      searchInput.addEventListener('input', function() {
        filterModels(this.value, currentCategory);
      });
      
      // åˆ†ç±»é¡¹ç‚¹å‡»
      const categoryItems = document.querySelectorAll('.category-item');
      categoryItems.forEach(item => {
        item.addEventListener('click', function() {
          // æ›´æ–°é€‰ä¸­çŠ¶æ€
          categoryItems.forEach(i => i.classList.remove('active'));
          this.classList.add('active');
          
          // æ›´æ–°å½“å‰åˆ†ç±»å¹¶è¿‡æ»¤æ¨¡å‹
          currentCategory = this.getAttribute('data-category');
          filterModels(searchInput.value, currentCategory);
        });
      });
      
      // åˆ†ç±»æ ‡é¢˜ç‚¹å‡»ï¼ˆæŠ˜å /å±•å¼€ï¼‰
      const categoryTitle = document.querySelector('.category-title');
      const dropdownArrow = document.querySelector('.dropdown-arrow');
      const categoryList = document.querySelector('.category-list');
      
      categoryTitle.addEventListener('click', function() {
        dropdownArrow.classList.toggle('open');
        categoryList.classList.toggle('open');
      });
      
      // çº¿æ¡†æ¨¡å¼æŒ‰é’®
      const btnWireframe = document.getElementById('btn-wireframe');
      btnWireframe.addEventListener('click', toggleWireframe);
      
      // è‡ªåŠ¨æ—‹è½¬æŒ‰é’®
      const btnAutoRotate = document.getElementById('btn-auto-rotate');
      btnAutoRotate.addEventListener('click', toggleAutoRotate);
      
      // é‡ç½®è§†è§’æŒ‰é’®
      const btnReset = document.getElementById('btn-reset');
      btnReset.addEventListener('click', resetCamera);
      
      // èƒŒæ™¯é¢œè‰²é€‰æ‹©
      const colorOptions = document.querySelectorAll('.color-option');
      colorOptions.forEach(option => {
        option.addEventListener('click', function() {
          const color = this.getAttribute('data-color');
          changeBackgroundColor(color);
        });
      });
    }
    
    // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
    window.addEventListener('load', function() {
      // åˆå§‹åŒ–åœºæ™¯
      initScene();
      
      // åˆå§‹åŒ–äº‹ä»¶ç›‘å¬å™¨
      initEventListeners();
      
      // åŠ è½½æ¨¡å‹åˆ—è¡¨
      loadModelList();
      
      // é€‚åº”çª—å£å¤§å°
      onWindowResize();
    });
  </script>
</body>
</html> 