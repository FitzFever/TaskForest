# TaskForest_动画和特效规范

## 概述

本文档定义了TaskForest项目中所有树木生长动画和特效的设计标准与实现规范。遵循这些指南可确保所有视觉效果保持统一的美术风格，并满足项目的技术性能要求。

## 树木生长动画

### 动画设计原则

TaskForest项目的树木生长动画遵循以下核心原则：

1. **自然逼真**：模拟真实植物生长过程，但适度加速与艺术化处理
2. **阶段清晰**：种子、幼苗、成长、成熟阶段有明显的过渡
3. **性能优化**：动画不应过度消耗系统资源
4. **视觉满足感**：动画应给予玩家成就感和满足感

### 动画类型与标准

#### 1. 萌芽动画（种子到幼苗）
- **动画时长**：1.5-2秒
- **关键帧数**：8-12帧
- **特征动作**：
  - 种子微微膨胀
  - 第一片叶子/芽从土中冒出
  - 主干缓慢生长
  - 最初的2-3片叶子舒展开

#### 2. 幼苗成长动画（幼苗到成长阶段）
- **动画时长**：2-3秒
- **关键帧数**：10-15帧
- **特征动作**：
  - 主干加粗并延长
  - 初始分枝形成
  - 更多叶片生长出
  - 整体体积显著增大

#### 3. 成熟动画（成长阶段到成熟阶段）
- **动画时长**：2.5-3.5秒
- **关键帧数**：12-18帧
- **特征动作**：
  - 树冠扩展
  - 树干达到最终高度和粗度
  - 分枝结构完善
  - 果实/花朵形成（适用于特定树种）

### 特定树种的动画特点

#### 橡树
- 强调主干粗壮和树冠扩展
- 缓慢但稳定的生长节奏
- 最终阶段可显示橡果

#### 松树
- 突出垂直生长的特征
- 分层的针叶生长模式
- 明显的锥形树冠展开

#### 樱花树
- 优雅的分枝生长
- 成熟阶段樱花绽放特效
- 花瓣飘落动画（可选）

#### 棕榈树
- 主干直立延伸
- 叶片从顶部扇形展开
- 成熟阶段椰子/棕榈果出现

#### 苹果树
- 均衡的树冠生长
- 成熟阶段红色苹果出现
- 可选的花朵绽放过渡

## 环境特效

### 天气效果

#### 1. 阳光效果
- **光照变化**：模拟一天中不同时段光照
- **技术实现**：使用定向光与环境光结合
- **性能消耗**：低-中

#### 2. 雨水效果
- **视觉表现**：
  - 雨滴粒子系统
  - 树叶上的雨滴积累
  - 地面湿润变化
- **技术实现**：半透明粒子系统+法线贴图变化
- **性能消耗**：中

#### 3. 风效果
- **视觉表现**：树叶和细枝摇摆
- **技术实现**：顶点动画或骨骼动画
- **性能消耗**：中-高（使用LOD优化）

### 季节效果

#### 春季
- **颜色风格**：明亮绿色与花朵色彩
- **视觉元素**：花朵、嫩叶、花瓣飘落
- **特殊效果**：蜜蜂、蝴蝶粒子（可选）

#### 夏季
- **颜色风格**：深绿色，饱和度高
- **视觉元素**：茂密叶片，繁茂树冠
- **特殊效果**：热浪扭曲（可选）

#### 秋季
- **颜色风格**：红色、橙色、黄色
- **视觉元素**：变色叶片，落叶
- **特殊效果**：落叶飘动

#### 冬季
- **颜色风格**：灰白色，低饱和度
- **视觉元素**：树干、光秃的树枝、雪
- **特殊效果**：飘雪、枝干结霜

## 特效技术规范

### 粒子系统

粒子系统用于实现多种自然效果：

- **落叶/花瓣**：
  - 每个树最大粒子数：20-30
  - LOD降级：>100米距离关闭
  - 纹理尺寸：128x128像素

- **发光效果（如萤火虫）**：
  - 最大粒子数：15-25/区域
  - 使用加法混合模式
  - 包含随机运动路径

### 着色器效果

- **树叶摇摆着色器**：
  - 基于顶点偏移的风效果
  - 风力强度和方向参数可调
  - 三层嵌套噪声实现自然摇摆

- **成长效果着色器**：
  - 控制对象缩放和透明度
  - 使用曲线编辑器定义生长时间线
  - 支持分段控制不同部位生长速率

### 动画系统技术实现

#### 骨骼动画

- 主要用于较复杂的树木动画
- 骨骼层级不超过3级
- 权重绘制优化以提高性能

#### 变形动画

- 用于简单的生长效果
- 关键形态之间的插值
- 适用于低多边形模型

#### 程序化动画

- 风吹效果
- 基于物理的花瓣/叶子飘落
- 使用噪声函数实现自然变化

## 优化策略

### LOD系统

为确保在各种硬件上的良好性能，特效应实现多级LOD：

| 距离(米) | 动画细节 | 粒子数量 | 特效质量 |
|---------|---------|---------|---------|
| 0-20    | 100%    | 100%    | 高      |
| 20-50   | 75%     | 50%     | 中      |
| 50-100  | 50%     | 25%     | 低      |
| >100    | 0%      | 0%      | 无      |

### 批处理优化

- 相同树种使用实例化渲染
- 合并相似材质减少渲染调用
- 使用材质图集优化纹理内存

### 移动设备优化

- 降低粒子数量至50%
- 简化着色器复杂度
- 降低动画帧率

## 制作工作流程

1. **概念设计**：定义动画关键帧和时间线
2. **原型创建**：在Blender中创建测试动画
3. **技术实现**：转换为游戏引擎中可用的格式
4. **性能测试**：在目标平台上测试
5. **迭代优化**：基于测试结果调整

## 提交规范

动画和特效资产应包含以下内容：

1. **源文件**：.blend文件，包含完整动画设置
2. **导出文件**：引擎可用的动画文件
3. **参数文档**：特效参数说明
4. **性能报告**：各LOD级别的性能测试报告

## 常见问题与解决方案

| 问题 | 解决方案 |
|------|---------|
| 动画卡顿 | 减少关键帧数量，简化模型 |
| 内存占用高 | 优化纹理尺寸，合并材质 |
| 粒子系统性能低 | 减少粒子数量，使用预渲染纹理 |
| 移动设备过热 | 实施更激进的LOD策略 |

---

*最后更新：2023年5月15日*
